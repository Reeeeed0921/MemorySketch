<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MemorySketch 一忆像师 情感记忆生成系统</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- 头部导航 -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-brain"></i>
                <h1>MemorySketch 一忆像师 情感记忆生成系统</h1>
            </div>
            <div class="status-indicators">
                <div class="status-item" id="system-status">
                    <i class="fas fa-circle"></i>
                    <span>系统状态</span>
                </div>
                <div class="status-item" id="api-status">
                    <i class="fas fa-circle"></i>
                    <span>API服务</span>
                </div>
            </div>
        </header>

        <!-- 基本信息输出面板 -->
        <section class="system-info-section">
            <div class="system-info-panel">
                <div class="info-header">
                    <h2>
                        <i class="fas fa-info-circle"></i>
                        系统基本信息
                    </h2>
                    <button id="refresh-system-info" class="btn btn-secondary btn-sm">
                        <i class="fas fa-sync-alt"></i> 刷新
                    </button>
                </div>
                
                <div class="info-grid">
                    <!-- 系统状态信息 -->
                    <div class="info-card">
                        <div class="info-card-header">
                            <i class="fas fa-server"></i>
                            <h3>系统状态</h3>
                        </div>
                        <div class="info-card-content">
                            <div class="info-item">
                                <span class="info-label">系统版本:</span>
                                <span class="info-value" id="system-version">PGG v1.0.0</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">运行模式:</span>
                                <span class="info-value" id="debug-mode">开发模式</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">存储模式:</span>
                                <span class="info-value" id="storage-mode">本地存储</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">CPU模式:</span>
                                <span class="info-value" id="cpu-mode">启用</span>
                            </div>
                        </div>
                    </div>

                    <!-- API服务状态 -->
                    <div class="info-card">
                        <div class="info-card-header">
                            <i class="fas fa-plug"></i>
                            <h3>API服务状态</h3>
                        </div>
                        <div class="info-card-content">
                            <div class="info-item">
                                <span class="info-label">OpenAI:</span>
                                <span class="info-value api-status" id="openai-status">
                                    <i class="fas fa-circle"></i> 未配置
                                </span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">科大讯飞语音:</span>
                                <span class="info-value api-status" id="iflytek-speech-status">
                                    <i class="fas fa-circle"></i> 已配置
                                </span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">科大讯飞图像:</span>
                                <span class="info-value api-status" id="iflytek-image-status">
                                    <i class="fas fa-circle"></i> 已配置
                                </span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">性别年龄识别:</span>
                                <span class="info-value api-status" id="iflytek-gender-age-status">
                                    <i class="fas fa-circle"></i> 已配置
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- 模型状态 -->
                    <div class="info-card">
                        <div class="info-card-header">
                            <i class="fas fa-brain"></i>
                            <h3>AI模型状态</h3>
                        </div>
                        <div class="info-card-content">
                            <div class="info-item">
                                <span class="info-label">情感分析:</span>
                                <span class="info-value model-status" id="emotion-model-status">
                                    <i class="fas fa-circle"></i> 可用
                                </span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">图像生成:</span>
                                <span class="info-value model-status" id="image-model-status">
                                    <i class="fas fa-circle"></i> 可用
                                </span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">语音识别:</span>
                                <span class="info-value model-status" id="speech-model-status">
                                    <i class="fas fa-circle"></i> 可用
                                </span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">可用模型数:</span>
                                <span class="info-value" id="available-models-count">4</span>
                            </div>
                        </div>
                    </div>

                    <!-- 系统配置 -->
                    <div class="info-card">
                        <div class="info-card-header">
                            <i class="fas fa-cogs"></i>
                            <h3>系统配置</h3>
                        </div>
                        <div class="info-card-content">
                            <div class="info-item">
                                <span class="info-label">准确率优先:</span>
                                <span class="info-value" id="accuracy-priority">启用</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">最大内存:</span>
                                <span class="info-value" id="max-memory">512MB</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">批处理大小:</span>
                                <span class="info-value" id="batch-size">1</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">服务端口:</span>
                                <span class="info-value" id="server-port">5000</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 展开/收起按钮 -->
                <div class="info-toggle">
                    <button id="toggle-system-info" class="btn btn-info btn-sm">
                        <i class="fas fa-chevron-up"></i>
                        <span>收起详情</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- 主要内容区域 -->
        <main class="main-content">
            <!-- 系统统计 -->
            <section class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-memory"></i></div>
                        <div class="stat-info">
                            <h3 id="total-memories">0</h3>
                            <p>总回忆数</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <h3 id="total-users">0</h3>
                            <p>用户数</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-heart"></i></div>
                        <div class="stat-info">
                            <h3 id="avg-emotion">0%</h3>
                            <p>平均情感分数</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-microphone"></i></div>
                        <div class="stat-info">
                            <h3 id="speech-status">可用</h3>
                            <p>语音服务</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 功能选项卡 -->
            <section class="tabs-section">
                <div class="tabs">
                    <button class="tab-button active" data-tab="generate">生成回忆</button>
                    <button class="tab-button" data-tab="speech">语音转文本</button>
                    <button class="tab-button" data-tab="history">历史记录</button>
                    <button class="tab-button" data-tab="test">API测试</button>
                </div>

                <!-- 生成回忆面板 -->
                <div class="tab-content active" id="generate-tab">
                    <div class="panel">
                        <h2><i class="fas fa-magic"></i> 生成回忆</h2>
                        <form id="generate-form">
                            <div class="form-group">
                                <label for="memory-text">输入文本内容:</label>
                                <textarea id="memory-text" placeholder="请输入要生成回忆的文本内容..." rows="4" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="user-id">用户ID:</label>
                                <input type="text" id="user-id" placeholder="输入用户ID (可选)" value="user123">
                            </div>
                            <div class="form-group">
                                <label for="emotion-override">情感类型 (可选):</label>
                                <select id="emotion-override">
                                    <option value="">自动检测</option>
                                    <option value="joy">快乐</option>
                                    <option value="sadness">悲伤</option>
                                    <option value="anger">愤怒</option>
                                    <option value="fear">恐惧</option>
                                    <option value="surprise">惊讶</option>
                                    <option value="disgust">厌恶</option>
                                    <option value="love">爱意</option>
                                    <option value="excitement">兴奋</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-magic"></i> 生成回忆
                            </button>
                        </form>
                        <div id="generate-result" class="result-section"></div>
                    </div>
                </div>

                <!-- 语音转文本面板 -->
                <div class="tab-content" id="speech-tab">
                    <div class="panel">
                        <h2><i class="fas fa-microphone"></i> 语音转文本</h2>
                        
                        <!-- 实时录音部分 -->
                        <div class="speech-section">
                            <h3><i class="fas fa-microphone-alt"></i> 实时录音</h3>
                            <div class="realtime-controls">
                                <div class="recording-area">
                                    <div class="recording-visual">
                                        <div id="recording-indicator" class="recording-indicator">
                                            <div class="pulse-ring"></div>
                                            <div class="pulse-ring"></div>
                                            <div class="pulse-ring"></div>
                                            <i class="fas fa-microphone"></i>
                                        </div>
                                    </div>
                                    <div class="recording-info">
                                        <div id="recording-status" class="recording-status">准备录音</div>
                                        <div id="recording-time" class="recording-time">00:00</div>
                                    </div>
                                </div>
                                
                                <div class="recording-controls">
                                    <div class="form-group">
                                        <label for="realtime-language">语言:</label>
                                        <select id="realtime-language">
                                            <option value="zh-CN">中文</option>
                                            <option value="en-US">英文</option>
                                            <option value="ja-JP">日文</option>
                                            <option value="ko-KR">韩文</option>
                                        </select>
                                    </div>
                                    
                                    <div class="recording-buttons">
                                        <button id="start-recording" class="btn btn-success">
                                            <i class="fas fa-microphone"></i> 开始录音
                                        </button>
                                        <button id="stop-recording" class="btn btn-danger" disabled>
                                            <i class="fas fa-stop"></i> 停止录音
                                        </button>
                                        <button id="clear-recording" class="btn btn-secondary">
                                            <i class="fas fa-trash"></i> 清除
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="realtime-result" class="result-section">
                                <h4>实时转换结果:</h4>
                                <div id="realtime-text" class="speech-text-output"></div>
                            </div>
                        </div>

                        <!-- 分隔线 -->
                        <div class="section-divider"></div>

                        <!-- 文件上传部分 -->
                        <div class="speech-section">
                            <h3><i class="fas fa-file-audio"></i> 文件上传</h3>
                            <form id="speech-form">
                                <div class="form-group">
                                    <label for="audio-file">选择音频文件:</label>
                                    <input type="file" id="audio-file" accept="audio/*" required>
                                    <small>支持格式: WAV, MP3, FLAC, M4A (最大25MB)</small>
                                </div>
                                <div class="form-group">
                                    <label for="language">语言:</label>
                                    <select id="language">
                                        <option value="zh-CN">中文</option>
                                        <option value="en-US">英文</option>
                                        <option value="ja-JP">日文</option>
                                        <option value="ko-KR">韩文</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-upload"></i> 转换语音
                                </button>
                            </form>
                            <div id="speech-result" class="result-section"></div>
                        </div>
                    </div>
                </div>

                <!-- 历史记录面板 -->
                <div class="tab-content" id="history-tab">
                    <div class="panel">
                        <h2><i class="fas fa-history"></i> 历史记录</h2>
                        <div class="history-controls">
                            <input type="text" id="history-search" placeholder="搜索历史记录...">
                            <button id="refresh-history" class="btn btn-secondary">
                                <i class="fas fa-refresh"></i> 刷新
                            </button>
                        </div>
                        <div id="history-list" class="history-list"></div>
                    </div>
                </div>

                <!-- API测试面板 -->
                <div class="tab-content" id="test-tab">
                    <div class="panel">
                        <h2><i class="fas fa-flask"></i> API测试</h2>
                        <div class="api-tests">
                            <div class="test-item">
                                <h3>系统健康检查</h3>
                                <button onclick="testHealth()" class="btn btn-info">
                                    <i class="fas fa-heartbeat"></i> 测试健康状态
                                </button>
                                <div id="health-result" class="test-result"></div>
                            </div>
                            <div class="test-item">
                                <h3>语音服务状态</h3>
                                <button onclick="testSpeechStatus()" class="btn btn-info">
                                    <i class="fas fa-microphone"></i> 测试语音服务
                                </button>
                                <div id="speech-service-result" class="test-result"></div>
                            </div>
                            <div class="test-item">
                                <h3>系统统计</h3>
                                <button onclick="testStats()" class="btn btn-info">
                                    <i class="fas fa-chart-bar"></i> 获取统计信息
                                </button>
                                <div id="stats-result" class="test-result"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- 底部信息 -->
        <footer class="footer">
            <p>&copy; 2024 PGG情感记忆生成系统 | 
                <span id="footer-status">系统运行中...</span>
            </p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html> 